# Coluna cxfuseq da tabela dbcaixa passa a ser obrigatorio
# Coluna notnull|obrigatorio da tabela campos se torna required
# Verificar se todas as tabelas tem o statseq como valor padrão 1
# Adicionar na view_inscricao as colunas vencimentomatricula, vencimentotaxa
# Adicionar a coluna formapag na view_caixa (dbforma_pagamento -> titulo)

# VIEW DE PESSOAS
	-- View: view_pessoa

-- DROP VIEW view_pessoa;

	DROP VIEW view_pessoa;
	
	CREATE OR REPLACE VIEW view_pessoa AS 
	 SELECT t1.seq, t1.unidseq, t1.usuaseq, t1.tipo, t1.pessnmrz, t1.pessnmrf, t1.pessrgie, t1.pessteim, t1.cliente, t1.fornecedor, t1.funcionario, to_char(t1.datacad::timestamp with time zone, 'DD/MM/YYYY'::text) AS datacad, t999.seq AS statseq, t999.statdesc, t2.telefone AS telefone1, t3.telefone AS telefone2, t1.email_principal,t1.email_secundario
	   FROM dbpessoa t1
	   LEFT JOIN dbtelefone t2 ON t2.pessseq = t1.seq AND t2.tpteseq = 1
	   LEFT JOIN dbtelefone t3 ON t3.pessseq = t1.seq AND t3.tpteseq = 2
	   LEFT JOIN dbstatus t999 ON t999.seq = t1.statseq;
	
	ALTER TABLE view_pessoa
	  OWNER TO postgres;


	
#VIEW PESSOAS_TITULARIDADAE
	CREATE OR REPLACE VIEW view_pessoa_titularidade AS 
	 SELECT t0.seq, t0.unidseq, t0.usuaseq, t0.pessseq, t0.tituseq, t0.curso, t0.instituicao, t0.anoconclusao, t0.observacao, to_char(t0.datacad::timestamp with time zone, 'DD/MM/YYYY'::text) AS datacad, t999.seq AS statseq, t999.statdesc, t3.pessnmrz AS nomepessoa, t2.titulo AS titularidade, t2.nomeacao, t2.peso, t4.seq AS profseq, t5.seq AS funcseq
	   FROM dbpessoa_titularidade t0
	   LEFT JOIN dbtitularidade t2 ON t2.seq = t0.tituseq
	   LEFT JOIN dbpessoa t3 ON t3.seq = t0.pessseq
	   LEFT JOIN dbprofessor t4 ON t4.pessseq = t3.seq
	   LEFT JOIN dbfuncionario t5 ON t5.pessseq = t3.seq
	   LEFT JOIN dbstatus t999 ON t999.seq = t0.statseq;
	  
#VIEW FUNCIONARIOS

	CREATE OR REPLACE VIEW view_funcionario AS 
	 SELECT t0.seq, t2.seq AS funcseq, t0.unidseq, t0.pessnmrz AS nomefuncionario, t0.pessnmrf, t2.cargseq, t3.nomecargo, t2.deptseq, t4.label AS nomedepartamento, t5.nome AS sala, t5.nome AS nomesala, to_char(t2.dataadmissao::timestamp with time zone, 'DD/MM/YYYY'::text) AS dataadmissao, t2.statseq AS situacao, to_char(t0.datacad::timestamp with time zone, 'DD/MM/YYYY'::text) AS datacad, t999.seq AS statseq, 
	 t999.statdesc,
	t6.telefone AS telefone1,
	t7.telefone AS telefone2,
	t0.email_principal AS email_principal,
	t0.email_secundario AS email_secundario
	   FROM dbpessoa t0
	   LEFT JOIN dbfuncionario t2 ON t2.pessseq = t0.seq
	   LEFT JOIN dbcargo t3 ON t3.seq = t2.cargseq
	   LEFT JOIN dbdepartamento t4 ON t4.seq = t2.deptseq
	   LEFT JOIN dbsala t5 ON t5.seq = t4.salaseq
	   LEFT JOIN dbstatus t999 ON t999.seq = t0.statseq
	   LEFT JOIN dbtelefone t6 ON t6.pessseq = t0.seq AND t6.tpteseq = 1
	   LEFT JOIN dbtelefone t7 ON t7.pessseq = t0.seq AND t7.tpteseq = 2 
	  WHERE t0.seq = t2.pessseq;

# VIEW PROFESSORES

	CREATE OR REPLACE VIEW view_professor AS 
	 SELECT t0.seq, t0.unidseq, t0.usuaseq, t0.pessseq, t0.curriculo, to_char(t0.datacad::timestamp with time zone, 'DD/MM/YYYY'::text) AS datacad, t999.seq AS statseq, t999.statdesc, t3.pessnmrz AS nomeprofessor, ( SELECT t2.titulo
	           FROM dbpessoa_titularidade t1
	      LEFT JOIN dbtitularidade t2 ON t1.tituseq = t2.seq
	     WHERE t1.pessseq = t3.seq
	     ORDER BY t2.peso DESC
	    LIMIT 1) AS titulo, ( SELECT t2.nomeacao
	           FROM dbpessoa_titularidade t1
	      LEFT JOIN dbtitularidade t2 ON t1.tituseq = t2.seq
	     WHERE t1.pessseq = t3.seq
	     ORDER BY t2.peso DESC
	    LIMIT 1) AS nomeacao,
	t6.telefone AS telefone1,
	t7.telefone AS telefone2,
	t3.email_principal AS email_principal,
	t3.email_secundario AS email_secundario
	   FROM dbprofessor t0
	   LEFT JOIN dbpessoa t3 ON t3.seq = t0.pessseq
	   LEFT JOIN dbtelefone t6 ON t6.pessseq = t3.seq AND t6.tpteseq = 1
	   LEFT JOIN dbtelefone t7 ON t7.pessseq = t3.seq AND t7.tpteseq = 2 
	   LEFT JOIN dbstatus t999 ON t999.seq = t0.statseq;
	
# VIEW INSCRICAO
	CREATE OR REPLACE VIEW view_inscricao AS 
	 SELECT 
	 t0.seq, 
	 t0.unidseq, 
	 t0.usuaseq, 
	 t0.pessseq, 
	 t0.transeq, 
	 t0.turmseq, 
	 t4.seq AS cursseq, 
	 to_char(t0.datacad::timestamp with time zone, 'DD/MM/YYYY'::text) AS datacad, 
	 t999.seq AS statseq, 
	 t999.statdesc, 
	 t2.pessnmrz AS nomepessoa, 
	 t2.pessnmrf, 
	 t3.titulo AS nometurma, 
	 t3.datainicio, 
	 t3.valortaxa, 
	 t3.parcelas, 
	 t3.valormatricula, 
	 t3.valormensal AS valorparcelas, 
	 t5.nome AS nomecurso, 
	 t0.vencimentomatricula, 
	 t0.vencimentotaxa,
	 t3.datainiciovencimentos,
	 t3.padraovencimento
	   FROM dbinscricao t0
	   LEFT JOIN dbpessoa t2 ON t2.seq = t0.pessseq
	   LEFT JOIN dbturma t3 ON t3.seq = t0.turmseq
	   LEFT JOIN dbcurso t4 ON t4.seq = t3.cursseq
	   LEFT JOIN dbprojeto_curso t5 ON t5.seq = t4.pjcuseq
	   LEFT JOIN dbstatus t999 ON t999.seq = t0.statseq;




# TABELA ENDEREÇO

	coluna logradouro para endereco varchar(200)

# TABELA TURMA
	coluna diafixovencimento para padraovencimento numeric
	
# TABELA PESSOA
	email_principal character varying(180)
	email_secundario character varying(180)
	
# REMOVER TABELA EMAIL



